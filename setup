local packer_bootstrap = false

-- Check if packer is installed
local install_path = vim.fn.stdpath('data')..'/site/pack/packer/start/packer.nvim'
if vim.fn.empty(vim.fn.glob(install_path)) > 0 then
    vim.fn.system({'git', 'clone', '--depth', '1', 'https://github.com/wbthomason/packer.nvim', install_path})
    packer_bootstrap = true
end

-- Load Packer
vim.cmd [[packadd packer.nvim]]

-- Packer plugin manager
require('packer').startup(function(use)
    use 'wbthomason/packer.nvim'  -- Packer can manage itself
    use 'neovim/nvim-lspconfig'  -- Collection of configurations for built-in LSP
    use 'theprimeagen/harpoon'  -- Harpoon for quick navigation
    use 'nvim-lua/plenary.nvim'  -- Required dependency for Harpoon

    -- Add Rust Analyzer
    use {
        'simrat39/rust-tools.nvim',
        config = function()
            require('rust-tools').setup({
                tools = {
                    autoSetHints = true,
                    inlay_hints = {
                        highlight = "SpecialComment",
                        prefix = "âž¤ ",
                        enabled = true,
                    },
                },
                server = {
                    on_attach = function(_, bufnr)
                        local opts = { noremap=true, silent=true }
                        vim.api.nvim_buf_set_keymap(bufnr, 'n', '<Leader>rn', ':RustRunnables<CR>', opts)
                        vim.api.nvim_buf_set_keymap(bufnr, 'n', '<Leader>ha', ':RustHoverActions<CR>', opts)
                    end,
                },
            })
        end,
    }

    if packer_bootstrap then
        require('packer').sync()
    end
end)

-- Set leader key and options
vim.g.mapleader = " "
vim.opt.number = true

-- Keybindings for Harpoon
vim.api.nvim_set_keymap("n", "<Leader>m", ":lua require('harpoon.ui').toggle_quick_menu()<CR>", { noremap = true, silent = true })
vim.api.nvim_set_keymap("n", "<Leader>a", ":lua require('harpoon.mark').add_file()<CR>", { noremap = true, silent = true })
